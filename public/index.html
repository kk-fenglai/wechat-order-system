<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中法集运订单管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- 导航栏 -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-shipping-fast me-2"></i>
                    中法集运订单管理
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#" @click="showOrderForm">
                                <i class="fas fa-plus me-1"></i>创建订单
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" @click="showOrderList">
                                <i class="fas fa-list me-1"></i>订单列表
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" @click="showStats">
                                <i class="fas fa-chart-bar me-1"></i>统计信息
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- 主要内容 -->
        <div class="container mt-4">
            <!-- 订单创建表单 -->
            <div v-if="currentView === 'orderForm'" class="order-form">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4><i class="fas fa-file-alt me-2"></i>创建新订单</h4>
                    </div>
                    <div class="card-body">
                        <form @submit.prevent="createOrder">
                            <!-- 客户信息 -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="border-bottom pb-2">
                                        <i class="fas fa-user me-2"></i>客户信息
                                    </h5>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">姓名 *</label>
                                    <input type="text" class="form-control" v-model="orderForm.customerInfo.name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">电话 *</label>
                                    <input type="tel" class="form-control" v-model="orderForm.customerInfo.phone" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">邮箱</label>
                                    <input type="email" class="form-control" v-model="orderForm.customerInfo.email">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">微信ID *</label>
                                    <input type="text" class="form-control" v-model="orderForm.wechatId" required>
                                </div>
                            </div>

                            <!-- 申报信息 -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="border-bottom pb-2">
                                        <i class="fas fa-box me-2"></i>申报信息
                                    </h5>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">用途 *</label>
                                    <select class="form-select" v-model="orderForm.declaration.purpose" required>
                                        <option value="">请选择用途</option>
                                        <option value="个人使用">个人使用</option>
                                        <option value="商业用途">商业用途</option>
                                        <option value="礼品">礼品</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">取件方式 *</label>
                                    <select class="form-select" v-model="orderForm.pickupMethod" required>
                                        <option value="">请选择取件方式</option>
                                        <option value="delivery">寄到指定地址 (€15)</option>
                                        <option value="selfPickup">自取 (€10)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- 货物清单 -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="border-bottom pb-2">
                                        <i class="fas fa-list me-2"></i>货物清单
                                        <button type="button" class="btn btn-sm btn-outline-primary ms-2" @click="addItem">
                                            <i class="fas fa-plus me-1"></i>添加物品
                                        </button>
                                    </h5>
                                </div>
                                <div class="col-12">
                                    <div v-for="(item, index) in orderForm.declaration.items" :key="index" class="row mb-3 border rounded p-3">
                                        <div class="col-md-3 mb-2">
                                            <label class="form-label">物品名称 *</label>
                                            <input type="text" class="form-control" v-model="item.name" required>
                                        </div>
                                        <div class="col-md-2 mb-2">
                                            <label class="form-label">数量 *</label>
                                            <input type="number" class="form-control" v-model="item.quantity" min="1" required>
                                        </div>
                                        <div class="col-md-2 mb-2">
                                            <label class="form-label">价值 (€) *</label>
                                            <input type="number" class="form-control" v-model="item.value" min="0" step="0.01" required>
                                        </div>
                                        <div class="col-md-2 mb-2">
                                            <label class="form-label">重量 (kg) *</label>
                                            <input type="number" class="form-control" v-model="item.weight" min="0" step="0.1" required>
                                        </div>
                                        <div class="col-md-2 mb-2">
                                            <label class="form-label">描述</label>
                                            <input type="text" class="form-control" v-model="item.description">
                                        </div>
                                        <div class="col-md-1 mb-2 d-flex align-items-end">
                                            <button type="button" class="btn btn-danger btn-sm" @click="removeItem(index)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 费用预览 -->
                            <div class="row mb-4" v-if="orderForm.declaration.items.length > 0">
                                <div class="col-12">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6><i class="fas fa-calculator me-2"></i>费用预览</h6>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <small class="text-muted">总价值:</small>
                                                    <div class="fw-bold">€{{ totalValue.toFixed(2) }}</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <small class="text-muted">总重量:</small>
                                                    <div class="fw-bold">{{ totalWeight.toFixed(1) }} kg</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <small class="text-muted">预估运费:</small>
                                                    <div class="fw-bold">€{{ estimatedShipping.toFixed(2) }}</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <small class="text-muted">取件费:</small>
                                                    <div class="fw-bold">€{{ pickupFee.toFixed(2) }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 提交按钮 -->
                            <div class="row">
                                <div class="col-12 text-center">
                                    <button type="submit" class="btn btn-primary btn-lg" :disabled="isSubmitting">
                                        <i class="fas fa-paper-plane me-2"></i>
                                        {{ isSubmitting ? '创建中...' : '创建订单' }}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 订单列表 -->
            <div v-if="currentView === 'orderList'" class="order-list">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4><i class="fas fa-list me-2"></i>订单列表</h4>
                        <div>
                            <select class="form-select form-select-sm" v-model="statusFilter" @change="loadOrders">
                                <option value="">全部状态</option>
                                <option value="信息收集">信息收集</option>
                                <option value="信息审核">信息审核</option>
                                <option value="地址分配">地址分配</option>
                                <option value="包裹入库">包裹入库</option>
                                <option value="内容检查">内容检查</option>
                                <option value="重新打包">重新打包</option>
                                <option value="费用计算">费用计算</option>
                                <option value="等待付款">等待付款</option>
                                <option value="已付款">已付款</option>
                                <option value="运输中">运输中</option>
                                <option value="待取件">待取件</option>
                                <option value="已完成">已完成</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div v-if="loading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                        </div>
                        <div v-else-if="orders.length === 0" class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="text-muted">暂无订单</p>
                        </div>
                        <div v-else>
                            <div v-for="order in orders" :key="order._id" class="order-item border rounded p-3 mb-3">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <h6 class="mb-1">订单号: {{ order.orderNumber }}</h6>
                                        <small class="text-muted">{{ formatDate(order.createdAt) }}</small>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="badge" :class="getStatusBadgeClass(order.status)">
                                            {{ order.status }}
                                        </span>
                                    </div>
                                    <div class="col-md-2">
                                        <strong>€{{ order.fees.total.toFixed(2) }}</strong>
                                    </div>
                                    <div class="col-md-3">
                                        <small>{{ order.customer.name }} - {{ order.customer.phone }}</small>
                                    </div>
                                    <div class="col-md-2 text-end">
                                        <button class="btn btn-sm btn-outline-primary" @click="viewOrder(order)">
                                            <i class="fas fa-eye me-1"></i>查看
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 统计信息 -->
            <div v-if="currentView === 'stats'" class="stats">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                <h4>{{ stats.totalOrders }}</h4>
                                <p class="mb-0">总订单数</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-check-circle fa-2x mb-2"></i>
                                <h4>{{ stats.completedOrders }}</h4>
                                <p class="mb-0">已完成订单</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-euro-sign fa-2x mb-2"></i>
                                <h4>€{{ stats.totalRevenue.toFixed(2) }}</h4>
                                <p class="mb-0">总收入</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 订单详情模态框 -->
        <div class="modal fade" id="orderModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">订单详情</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" v-if="selectedOrder">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>基本信息</h6>
                                <p><strong>订单号:</strong> {{ selectedOrder.orderNumber }}</p>
                                <p><strong>状态:</strong> 
                                    <span class="badge" :class="getStatusBadgeClass(selectedOrder.status)">
                                        {{ selectedOrder.status }}
                                    </span>
                                </p>
                                <p><strong>创建时间:</strong> {{ formatDate(selectedOrder.createdAt) }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>客户信息</h6>
                                <p><strong>姓名:</strong> {{ selectedOrder.customer.name }}</p>
                                <p><strong>电话:</strong> {{ selectedOrder.customer.phone }}</p>
                                <p><strong>邮箱:</strong> {{ selectedOrder.customer.email || '未提供' }}</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>费用信息</h6>
                                <p><strong>运费:</strong> €{{ selectedOrder.fees.shipping.toFixed(2) }}</p>
                                <p><strong>手续费:</strong> €{{ selectedOrder.fees.handling.toFixed(2) }}</p>
                                <p><strong>取件费:</strong> €{{ selectedOrder.fees.pickup.toFixed(2) }}</p>
                                <p><strong>总计:</strong> €{{ selectedOrder.fees.total.toFixed(2) }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>取件信息</h6>
                                <p><strong>方式:</strong> {{ selectedOrder.pickup.method === 'delivery' ? '寄送' : '自取' }}</p>
                                <p v-if="selectedOrder.pickup.address"><strong>地址:</strong> {{ selectedOrder.pickup.address }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.31/dist/vue.global.js"></script>
    <script src="app.js"></script>
</body>
</html> 